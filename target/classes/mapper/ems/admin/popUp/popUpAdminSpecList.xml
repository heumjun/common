<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="popUpAdminSpecList">

	<select id="list" parameterType="java.util.Map" resultType="org.apache.commons.collections.map.CaseInsensitiveMap" >
		select t2.*                                           
		from (                                               
		select t1.*, COUNT(*) OVER() AS CNT                                            
		,floor((rownum - 1) / #{rows} + 1 ) as page                 
		from                                               
		(                                               
		SELECT MAX(MASTER) MASTER                                    
		    ,MAX(PROJECT) PROJECT                                  
		    ,MAX(DWG_NO) DWG_NO                                    
		    ,MODEL                                          
		    ,CORP_NAME                                        
		    ,REV                                          
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE1),0) FILE1                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE2),0) FILE2                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE3),0) FILE3                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE4),0) FILE4                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE5),0) FILE5                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE6),0) FILE6                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE7),0) FILE7                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE8),0) FILE8                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE9),0) FILE9                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE10),0) FILE10                    
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE11),0) FILE11                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE12),0) FILE12                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE13),0) FILE13                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE14),0) FILE14                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE15),0) FILE15                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE16),0) FILE16                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE17),0) FILE17                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE18),0) FILE18                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE19),0) FILE19                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE20),0) FILE20                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(RECEIPT_DATE),'') RECEIPT_DATE              
		    ,DECODE(MAX(ACT_TO),'조달',MAX(ANSWER_DATE),'') ANSWER_DATE                
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(COMMENTS1),'') COMMENTS1                
		    ,DECODE(MAX(ACT_TO),'조달',MAX(COMMENTS2),'') COMMENTS2                  
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FLAG1),'') FLAG1                    
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FLAG2),'') FLAG2                      
		  FROM (SELECT DISTINCT SEP.MASTER      
		        , SEP.PROJECT      
		        , SEP.DWG_NO      
		        , '' MODEL      
		        , SSR.VENDOR_SITE_NAME CORP_NAME    
		        , SSR.ACT_FROM    
		        , SSR.ACT_TO    
		        , (SELECT ABC FROM (SELECT A.*, (RANK() OVER(PARTITION BY PROJECT_NO, EQUIPMENT_NAME, VENDOR_SITE_NAME, ACT_FROM, ACT_TO ORDER BY SPEC_REVIEW_ID)) ABC  
		            FROM STX_PO_EPMS_SPEC_REVIEW@STXERP A) WHERE SPEC_REVIEW_ID = SSR.SPEC_REVIEW_ID AND PROJECT_NO = SSR.PROJECT_NO  
		             AND EQUIPMENT_NAME = SSR.EQUIPMENT_NAME AND VENDOR_SITE_NAME = SSR.VENDOR_SITE_NAME  
		             AND ACT_FROM = SSR.ACT_FROM AND ACT_TO = SSR.ACT_TO) - 1 REV    
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 1) FILE1      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 2) FILE2      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 3) FILE3      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 4) FILE4      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 5) FILE5      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 6) FILE6      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 7) FILE7      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 8) FILE8      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 9) FILE9      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 10) FILE10      
		        , 0 FILE11,0 FILE12,0 FILE13,0 FILE14,0 FILE15,0 FILE16,0 FILE17,0 FILE18,0 FILE19,0 FILE20    
		        , TO_CHAR(SSR.ACT_DATE,'YYYY-MM-DD') RECEIPT_DATE    
		        , '' ANSWER_DATE    
		        , SSR.COMPLETE_FLAG FLAG1                                    
		        , '' FLAG2                                    
		        , SSR.ACT_COMMENT COMMENTS1    
		        , '' COMMENTS2     
		      FROM STX_EMS_PURCHASING@STXERP            SEP
		          ,STX_PO_EPMS_SPEC_REVIEW@STXERP       SSR
		          ,STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP SFM     
		       WHERE 1=1     
		       AND SEP.PROJECT = SSR.PROJECT_NO     
		       AND SSR.EQUIPMENT_NAME  = (SELECT MAX(EQUIP_NAME) FROM STX_EMS_STANDARD_V@STXERP WHERE DWG_NO = SEP.DWG_NO)     
		       AND SSR.SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID     
		       AND SSR.ACT_FROM = '조달'     
		       AND SSR.ACT_TO = '설계'     
		       AND SSR.ACT_COMMENT != 'POS'             
		    UNION ALL    
		    SELECT DISTINCT SEP.MASTER      
		        , SEP.PROJECT      
		        , SEP.DWG_NO      
		        , '' MODEL      
		        , SSR.VENDOR_SITE_NAME CORP_NAME    
		        , SSR.ACT_FROM    
		        , SSR.ACT_TO    
		        , (SELECT ABC FROM (SELECT A.*, (RANK() OVER(PARTITION BY PROJECT_NO, EQUIPMENT_NAME, VENDOR_SITE_NAME, ACT_FROM, ACT_TO ORDER BY SPEC_REVIEW_ID)) ABC  
		            FROM STX_PO_EPMS_SPEC_REVIEW@STXERP A WHERE ACT_COMMENT != 'POS') WHERE SPEC_REVIEW_ID = SSR.SPEC_REVIEW_ID AND PROJECT_NO = SSR.PROJECT_NO  
		             AND EQUIPMENT_NAME = SSR.EQUIPMENT_NAME AND VENDOR_SITE_NAME = SSR.VENDOR_SITE_NAME  
		             AND ACT_FROM = SSR.ACT_FROM AND ACT_TO = SSR.ACT_TO) - 1 REV  
		        , 0 FILE1,0 FILE2,0 FILE3,0 FILE4,0 FILE5,0 FILE6,0 FILE7,0 FILE8,0 FILE9,0 FILE10    
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 1) FILE11      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 2) FILE12      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 3) FILE13      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 4) FILE14      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 5) FILE15      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 6) FILE16      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 7) FILE17      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 8) FILE18      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 9) FILE19      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 10) FILE20      
		        , '' RECEIPT_DATE    
		        , TO_CHAR(SSR.ACT_DATE,'YYYY-MM-DD') ANSWER_DATE    
		        , '' FLAG2                                    
		        , SSR.COMPLETE_FLAG FLAG2                                    
		        , '' COMMENTS1            
		        , SSR.ACT_COMMENT COMMENTS2      
		     FROM STX_EMS_PURCHASING@STXERP SEP, STX_PO_EPMS_SPEC_REVIEW@STXERP SSR, STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP SFM     
		    WHERE 1=1     
		      AND SEP.PROJECT = SSR.PROJECT_NO     
		      AND SSR.EQUIPMENT_NAME  = (SELECT MAX(EQUIP_NAME) FROM STX_EMS_STANDARD_V@STXERP WHERE DWG_NO = SEP.DWG_NO)     
		      AND SSR.SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID     
		      AND SSR.ACT_FROM = '설계'     
		      AND SSR.ACT_TO = '조달'     
		      AND SSR.ACT_COMMENT != 'POS') AB    
		  GROUP BY MODEL, CORP_NAME, REV    
		) t1  
		  WHERE 1=1 

		<if test="p_master != null and !p_master.equalsIgnoreCase('') and !p_master.equalsIgnoreCase('null') and !p_master.equalsIgnoreCase('*')">
		    AND MASTER = #{p_master}
		</if>  
		<if test="p_dwg_no != null and !p_dwg_no.equalsIgnoreCase('') and !p_dwg_no.equalsIgnoreCase('null') and !p_dwg_no.equalsIgnoreCase('*')">
		    AND DWG_NO IN (
		    <foreach collection="dwgNoArray" item="item" separator=",">
				#{item}
			</foreach>
		    )
		</if>    

		  
		) t2                                               
		where page = #{page}                            
		  ORDER BY t2.MASTER, t2.PROJECT, t2.DWG_NO, t2.CORP_NAME, t2.REV  
  	</select>
  	
  	<select id="selectTotalRecord" parameterType="java.util.Map" resultType="int" >
		select count(*)  
		from                                               
		(                                               
		SELECT MAX(MASTER) MASTER                                    
		    ,MAX(PROJECT) PROJECT                                  
		    ,MAX(DWG_NO) DWG_NO                                    
		    ,MODEL                                          
		    ,CORP_NAME                                        
		    ,REV                                          
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE1),0) FILE1                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE2),0) FILE2                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE3),0) FILE3                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE4),0) FILE4                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE5),0) FILE5                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE6),0) FILE6                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE7),0) FILE7                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE8),0) FILE8                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE9),0) FILE9                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FILE10),0) FILE10                    
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE11),0) FILE11                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE12),0) FILE12                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE13),0) FILE13                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE14),0) FILE14                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE15),0) FILE15                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE16),0) FILE16                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE17),0) FILE17                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE18),0) FILE18                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE19),0) FILE19                      
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FILE20),0) FILE20                      
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(RECEIPT_DATE),'') RECEIPT_DATE              
		    ,DECODE(MAX(ACT_TO),'조달',MAX(ANSWER_DATE),'') ANSWER_DATE                
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(COMMENTS1),'') COMMENTS1                
		    ,DECODE(MAX(ACT_TO),'조달',MAX(COMMENTS2),'') COMMENTS2                  
		    ,DECODE(MAX(ACT_FROM),'조달',MAX(FLAG1),'') FLAG1                    
		    ,DECODE(MAX(ACT_TO),'조달',MAX(FLAG2),'') FLAG2                      
		  FROM (SELECT DISTINCT SEP.MASTER      
		        , SEP.PROJECT      
		        , SEP.DWG_NO      
		        , '' MODEL      
		        , SSR.VENDOR_SITE_NAME CORP_NAME    
		        , SSR.ACT_FROM    
		        , SSR.ACT_TO    
		        , (SELECT ABC FROM (SELECT A.*, (RANK() OVER(PARTITION BY PROJECT_NO, EQUIPMENT_NAME, VENDOR_SITE_NAME, ACT_FROM, ACT_TO ORDER BY SPEC_REVIEW_ID)) ABC  
		            FROM STX_PO_EPMS_SPEC_REVIEW@STXERP A) WHERE SPEC_REVIEW_ID = SSR.SPEC_REVIEW_ID AND PROJECT_NO = SSR.PROJECT_NO  
		             AND EQUIPMENT_NAME = SSR.EQUIPMENT_NAME AND VENDOR_SITE_NAME = SSR.VENDOR_SITE_NAME  
		             AND ACT_FROM = SSR.ACT_FROM AND ACT_TO = SSR.ACT_TO) - 1 REV    
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 1) FILE1      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 2) FILE2      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 3) FILE3      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 4) FILE4      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 5) FILE5      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 6) FILE6      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 7) FILE7      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 8) FILE8      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 9) FILE9      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 10) FILE10      
		        , 0 FILE11,0 FILE12,0 FILE13,0 FILE14,0 FILE15,0 FILE16,0 FILE17,0 FILE18,0 FILE19,0 FILE20    
		        , TO_CHAR(SSR.ACT_DATE,'YYYY-MM-DD') RECEIPT_DATE    
		        , '' ANSWER_DATE    
		        , SSR.COMPLETE_FLAG FLAG1                                    
		        , '' FLAG2                                    
		        , SSR.ACT_COMMENT COMMENTS1    
		        , '' COMMENTS2     
		      FROM STX_EMS_PURCHASING@STXERP            SEP
		          ,STX_PO_EPMS_SPEC_REVIEW@STXERP       SSR
		          ,STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP SFM     
		       WHERE 1=1     
		       AND SEP.PROJECT = SSR.PROJECT_NO     
		       AND SSR.EQUIPMENT_NAME  = (SELECT MAX(EQUIP_NAME) FROM STX_EMS_STANDARD_V@STXERP WHERE DWG_NO = SEP.DWG_NO)     
		       AND SSR.SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID     
		       AND SSR.ACT_FROM = '조달'     
		       AND SSR.ACT_TO = '설계'     
		       AND SSR.ACT_COMMENT != 'POS'             
		    UNION ALL    
		    SELECT DISTINCT SEP.MASTER      
		        , SEP.PROJECT      
		        , SEP.DWG_NO      
		        , '' MODEL      
		        , SSR.VENDOR_SITE_NAME CORP_NAME    
		        , SSR.ACT_FROM    
		        , SSR.ACT_TO    
		        , (SELECT ABC FROM (SELECT A.*, (RANK() OVER(PARTITION BY PROJECT_NO, EQUIPMENT_NAME, VENDOR_SITE_NAME, ACT_FROM, ACT_TO ORDER BY SPEC_REVIEW_ID)) ABC  
		            FROM STX_PO_EPMS_SPEC_REVIEW@STXERP A WHERE ACT_COMMENT != 'POS') WHERE SPEC_REVIEW_ID = SSR.SPEC_REVIEW_ID AND PROJECT_NO = SSR.PROJECT_NO  
		             AND EQUIPMENT_NAME = SSR.EQUIPMENT_NAME AND VENDOR_SITE_NAME = SSR.VENDOR_SITE_NAME  
		             AND ACT_FROM = SSR.ACT_FROM AND ACT_TO = SSR.ACT_TO) - 1 REV  
		        , 0 FILE1,0 FILE2,0 FILE3,0 FILE4,0 FILE5,0 FILE6,0 FILE7,0 FILE8,0 FILE9,0 FILE10    
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 1) FILE11      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 2) FILE12      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 3) FILE13      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 4) FILE14      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 5) FILE15      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 6) FILE16      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 7) FILE17      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 8) FILE18      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 9) FILE19      
		        , (SELECT FILE_ID FROM (SELECT A.FILE_ID,A.SPEC_REVIEW_ID,(RANK() OVER(PARTITION BY SPEC_REVIEW_ID ORDER BY FILE_ID)) ABC FROM STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP A) WHERE SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID AND ABC = 10) FILE20      
		        , '' RECEIPT_DATE    
		        , TO_CHAR(SSR.ACT_DATE,'YYYY-MM-DD') ANSWER_DATE    
		        , '' FLAG2                                    
		        , SSR.COMPLETE_FLAG FLAG2                                    
		        , '' COMMENTS1            
		        , SSR.ACT_COMMENT COMMENTS2      
		     FROM STX_EMS_PURCHASING@STXERP SEP, STX_PO_EPMS_SPEC_REVIEW@STXERP SSR, STX_PO_EPMS_SPEC_FILE_MAPPING@STXERP SFM     
		    WHERE 1=1     
		      AND SEP.PROJECT = SSR.PROJECT_NO     
		      AND SSR.EQUIPMENT_NAME  = (SELECT MAX(EQUIP_NAME) FROM STX_EMS_STANDARD_V@STXERP WHERE DWG_NO = SEP.DWG_NO)     
		      AND SSR.SPEC_REVIEW_ID = SFM.SPEC_REVIEW_ID     
		      AND SSR.ACT_FROM = '설계'     
		      AND SSR.ACT_TO = '조달'     
		      AND SSR.ACT_COMMENT != 'POS') AB    
		  GROUP BY MODEL, CORP_NAME, REV    
		) t1  
		  WHERE 1=1 
		<if test="p_master != null and !p_master.equalsIgnoreCase('') and !p_master.equalsIgnoreCase('null') and !p_master.equalsIgnoreCase('*')">
		    AND MASTER = #{p_master}
		</if>  
		<if test="p_dwg_no != null and !p_dwg_no.equalsIgnoreCase('') and !p_dwg_no.equalsIgnoreCase('null') and !p_dwg_no.equalsIgnoreCase('*')">
		    AND DWG_NO IN (
		    <foreach collection="dwgNoArray" item="item" separator=",">
			    #{item}
			</foreach>
		    )
		</if>
	</select>
	
</mapper>